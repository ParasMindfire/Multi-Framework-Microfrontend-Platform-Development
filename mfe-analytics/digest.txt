Directory structure:
└── mfe-analytics/
    ├── README.md
    ├── Dockerfile
    ├── index.html
    ├── nginx.conf
    ├── package.json
    ├── svelte.config.js
    ├── tsconfig.app.json
    ├── tsconfig.json
    ├── tsconfig.node.json
    ├── vite.config.ts
    ├── src/
    │   ├── app.css
    │   ├── App.svelte
    │   ├── main.ts
    │   ├── style.css
    │   ├── wrapper.ts
    │   ├── components/
    │   │   ├── CrewLoadChart.svelte
    │   │   ├── FlightActivityChart.svelte
    │   │   └── InventoryDeviationChart.svelte
    │   └── lib/
    │       └── Counter.svelte
    └── .__mf__temp/
        └── analytics/
            └── localSharedImportMap.js

================================================
FILE: README.md
================================================
# Svelte + TS + Vite

This template should help get you started developing with Svelte and TypeScript in Vite.

## Recommended IDE Setup

[VS Code](https://code.visualstudio.com/) + [Svelte](https://marketplace.visualstudio.com/items?itemName=svelte.svelte-vscode).

## Need an official Svelte framework?

Check out [SvelteKit](https://github.com/sveltejs/kit#readme), which is also powered by Vite. Deploy anywhere with its serverless-first approach and adapt to various platforms, with out of the box support for TypeScript, SCSS, and Less, and easily-added support for mdsvex, GraphQL, PostCSS, Tailwind CSS, and more.

## Technical considerations

**Why use this over SvelteKit?**

- It brings its own routing solution which might not be preferable for some users.
- It is first and foremost a framework that just happens to use Vite under the hood, not a Vite app.

This template contains as little as possible to get started with Vite + TypeScript + Svelte, while taking into account the developer experience with regards to HMR and intellisense. It demonstrates capabilities on par with the other `create-vite` templates and is a good starting point for beginners dipping their toes into a Vite + Svelte project.

Should you later need the extended capabilities and extensibility provided by SvelteKit, the template has been structured similarly to SvelteKit so that it is easy to migrate.

**Why `global.d.ts` instead of `compilerOptions.types` inside `jsconfig.json` or `tsconfig.json`?**

Setting `compilerOptions.types` shuts out all other types not explicitly listed in the configuration. Using triple-slash references keeps the default TypeScript setting of accepting type information from the entire workspace, while also adding `svelte` and `vite/client` type information.

**Why include `.vscode/extensions.json`?**

Other templates indirectly recommend extensions via the README, but this file allows VS Code to prompt the user to install the recommended extension upon opening the project.

**Why enable `allowJs` in the TS template?**

While `allowJs: false` would indeed prevent the use of `.js` files in the project, it does not prevent the use of JavaScript syntax in `.svelte` files. In addition, it would force `checkJs: false`, bringing the worst of both worlds: not being able to guarantee the entire codebase is TypeScript, and also having worse typechecking for the existing JavaScript. In addition, there are valid use cases in which a mixed codebase may be relevant.

**Why is HMR not preserving my local component state?**

HMR state preservation comes with a number of gotchas! It has been disabled by default in both `svelte-hmr` and `@sveltejs/vite-plugin-svelte` due to its often surprising behavior. You can read the details [here](https://github.com/rixo/svelte-hmr#svelte-hmr).

If you have state that's important to retain within a component, consider creating an external store which would not be replaced by HMR.

```ts
// store.ts
// An extremely simple external store
import { writable } from 'svelte/store'
export default writable(0)
```



================================================
FILE: Dockerfile
================================================
FROM node:20-alpine AS builder

WORKDIR /app

COPY package.json pnpm-workspace.yaml ./
COPY common ./common
COPY mfe-analytics ./mfe-analytics

RUN npm install -g pnpm
RUN pnpm install

WORKDIR /app/mfe-analytics
RUN pnpm run build:docker

FROM nginx:alpine

COPY --from=builder /app/mfe-analytics/dist /usr/share/nginx/html
COPY mfe-analytics/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]


================================================
FILE: index.html
================================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mfe-analytics</title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>



================================================
FILE: nginx.conf
================================================
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
    add_header Access-Control-Allow-Headers "Content-Type";

    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache";
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin *;
    }
}


================================================
FILE: package.json
================================================
{
  "name": "mfe-analytics",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "build:docker": "vite build",
    "preview": "vite preview",
    "check": "svelte-check --tsconfig ./tsconfig.app.json && tsc -p tsconfig.node.json"
  },
  "dependencies": {
    "@skycart/common": "workspace:*"
  },
  "devDependencies": {
    "@module-federation/vite": "^1.9.2",
    "@sveltejs/vite-plugin-svelte": "^6.2.1",
    "@tsconfig/svelte": "^5.0.6",
    "@types/node": "^24.10.1",
    "svelte": "^5.43.8",
    "svelte-check": "^4.3.4",
    "typescript": "~5.9.3",
    "vite": "^7.2.4"
  }
}



================================================
FILE: svelte.config.js
================================================
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte'

/** @type {import("@sveltejs/vite-plugin-svelte").SvelteConfig} */
export default {
  // Consult https://svelte.dev/docs#compile-time-svelte-preprocess
  // for more information about preprocessors
  preprocess: vitePreprocess(),
}



================================================
FILE: tsconfig.app.json
================================================
{
  "extends": "@tsconfig/svelte/tsconfig.json",
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "types": ["svelte", "vite/client"],
    "noEmit": true,
    /**
     * Typecheck JS in `.svelte` and `.js` files by default.
     * Disable checkJs if you'd like to use dynamic types in JS.
     * Note that setting allowJs false does not prevent the use
     * of JS in `.svelte` files.
     */
    "allowJs": true,
    "checkJs": true,
    "moduleDetection": "force",
    "paths": {
      "@skycart/common": ["../common/src"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.js", "src/**/*.svelte", "../common/src/**/*"]
}



================================================
FILE: tsconfig.json
================================================
{
  "files": [],
  "references": [{ "path": "./tsconfig.app.json" }, { "path": "./tsconfig.node.json" }]
}



================================================
FILE: tsconfig.node.json
================================================
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}



================================================
FILE: vite.config.ts
================================================
import { defineConfig } from 'vite'
import { svelte } from '@sveltejs/vite-plugin-svelte'
import { federation } from '@module-federation/vite'

export default defineConfig({
  server: {
    port: 4400,
    cors: true,
    strictPort: true,
  },
  preview: {
    port: 4400,
    cors: true,
    strictPort: true,
  },
  base: '/',
  build: {
    target: 'esnext',
    minify: false,
    cssCodeSplit: false,
    rollupOptions: {
      output: {
        format: 'es',
        assetFileNames: (assetInfo) => {
          if (assetInfo.name === 'style.css') return 'assets/index.css'
          return 'assets/[name]-[hash][extname]'
        },
      },
    },
  },
  plugins: [
    svelte(),
    federation({
      name: 'analytics',
      filename: 'remoteEntry.js',
      exposes: {
        './App': './src/wrapper.ts',
      },
      shared: {
        svelte: {
          singleton: true,
          requiredVersion: '^5.0.0',
        },
      },
    }),
  ],
})



================================================
FILE: src/app.css
================================================
[Empty file]


================================================
FILE: src/App.svelte
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x8d in position 2460: character maps to <undefined>


================================================
FILE: src/main.ts
================================================
import { mount } from 'svelte'
import './app.css'
import App from './App.svelte'

const app = mount(App, {
  target: document.getElementById('app')!,
})

export default app



================================================
FILE: src/style.css
================================================
[Empty file]


================================================
FILE: src/wrapper.ts
================================================
// mfe-analytics/src/wrapper.ts
import App from './App.svelte'
import { mount, unmount } from 'svelte'

class AnalyticsElement extends HTMLElement {
  private instance: any

  connectedCallback() {
    this.instance = mount(App, { target: this })
  }

  disconnectedCallback() {
    if (this.instance) {
      unmount(this.instance)
    }
  }
}

// Register the web component
if (!customElements.get('analytics-app')) {
  customElements.define('analytics-app', AnalyticsElement)
}

export default AnalyticsElement



================================================
FILE: src/components/CrewLoadChart.svelte
================================================
<script lang="ts">
  interface Props {
    count: number
  }

  let { count }: Props = $props()

  const maxCrew = 10
  let percentage = $derived(Math.min((count / maxCrew) * 100, 100))
  let status = $derived(
    count === 0 ? 'empty' :
    count < 5 ? 'understaffed' : 
    count <= 8 ? 'optimal' : 
    'overstaffed'
  )
  
  let statusColor = $derived(
    status === 'empty' ? '#94a3b8' :
    status === 'understaffed' ? '#ef4444' : 
    status === 'optimal' ? '#10b981' : 
    '#f59e0b'
  )

  let crewIcons = $derived(Array(count).fill('ðŸ‘¤'))
</script>

<div class="crew-chart">
  <div class="stat-display">
    <div class="count" style="color: {statusColor}">
      {count} / {maxCrew}
    </div>
    <div class="label">Crew Members</div>
  </div>

  <div class="crew-icons">
    {#each crewIcons as icon, index}
      <span 
        class="crew-icon" 
        style="animation-delay: {index * 0.1}s"
      >
        {icon}
      </span>
    {/each}
    {#if count === 0}
      <span class="no-crew">No crew assigned</span>
    {/if}
  </div>

  <div class="status-badge" style="background: {statusColor}">
    {status.toUpperCase()}
  </div>

  <svg width="100%" height="100" viewBox="0 0 200 100" class="crew-svg">
    <circle cx="100" cy="50" r="45" fill="none" stroke="#e5e7eb" stroke-width="8" />
    <circle 
      cx="100" 
      cy="50" 
      r="45" 
      fill="none" 
      stroke={statusColor}
      stroke-width="8"
      stroke-dasharray="{percentage * 2.827} 282.7"
      transform="rotate(-90 100 50)"
      class="progress-circle"
    />
    <text x="100" y="55" text-anchor="middle" font-size="24" font-weight="bold" fill={statusColor}>
      {percentage.toFixed(0)}%
    </text>
  </svg>
</div>

<style>
  .crew-chart {
    text-align: center;
  }

  .stat-display {
    margin-bottom: 1rem;
  }

  .count {
    font-size: 2.5rem;
    font-weight: bold;
    line-height: 1;
    transition: color 0.3s;
  }

  .label {
    color: #6b7280;
    font-size: 0.9rem;
    margin-top: 0.25rem;
  }

  .crew-icons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    justify-content: center;
    min-height: 60px;
    margin-bottom: 1rem;
    padding: 1rem;
    background: white;
    border-radius: 8px;
  }

  .crew-icon {
    font-size: 1.5rem;
    animation: fadeIn 0.3s ease forwards;
    opacity: 0;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  .no-crew {
    color: #9ca3af;
    font-style: italic;
    font-size: 0.9rem;
  }

  .status-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    color: white;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .crew-svg {
    margin-top: 1rem;
  }

  .progress-circle {
    transition: stroke-dasharray 0.5s ease;
  }
</style>


================================================
FILE: src/components/FlightActivityChart.svelte
================================================
<script lang="ts">
  interface Props {
    activities: Array<{ time: string; action: string }>
  }

  let { activities }: Props = $props()
</script>

<div class="activity-chart">
  {#if activities.length === 0}
    <div class="empty">No activity yet</div>
  {:else}
    <div class="activity-list">
      {#each activities as activity, index (index)}
        <div class="activity-item" style="animation-delay: {index * 0.05}s">
          <span class="time">{activity.time}</span>
          <span class="action">{activity.action}</span>
        </div>
      {/each}
    </div>
  {/if}
</div>

<style>
  .activity-chart {
    min-height: 200px;
  }

  .empty {
    text-align: center;
    padding: 3rem 1rem;
    color: #9ca3af;
    font-style: italic;
  }

  .activity-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    max-height: 300px;
    overflow-y: auto;
  }

  .activity-item {
    background: white;
    padding: 0.75rem;
    border-radius: 6px;
    border-left: 3px solid #667eea;
    display: flex;
    gap: 1rem;
    animation: slideIn 0.3s ease forwards;
    opacity: 0;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .time {
    color: #6366f1;
    font-weight: 600;
    font-size: 0.85rem;
    min-width: 80px;
  }

  .action {
    color: #24292e;
    font-size: 0.9rem;
  }
</style>


================================================
FILE: src/components/InventoryDeviationChart.svelte
================================================
<script lang="ts">
  interface Props {
    trolleyData: {
      trolley1: number
      trolley2: number
      trolley3: number
    }
  }

  let { trolleyData }: Props = $props()

  const maxItemsPerTrolley = 200 // Max capacity per trolley
  
  // Get actual counts from props
  let trolleyA = $derived(trolleyData.trolley1)
  let trolleyB = $derived(trolleyData.trolley2)
  let trolleyC = $derived(trolleyData.trolley3)
  let totalCount = $derived(trolleyA + trolleyB + trolleyC)
  
  // Calculate percentage heights for visual display (0-100)
  let heightA = $derived(Math.min((trolleyA / maxItemsPerTrolley) * 100, 100))
  let heightB = $derived(Math.min((trolleyB / maxItemsPerTrolley) * 100, 100))
  let heightC = $derived(Math.min((trolleyC / maxItemsPerTrolley) * 100, 100))
  
  // Overall stats
  let maxTotal = maxItemsPerTrolley * 3
  let percentage = $derived(Math.min((totalCount / maxTotal) * 100, 100))
  let status = $derived(
    percentage < 30 ? 'Low Stock' : 
    percentage < 70 ? 'Good' : 
    percentage >= 100 ? 'At Capacity' : 'High'
  )
  
  let statusColor = $derived(
    percentage < 30 ? '#ef4444' : 
    percentage < 70 ? '#10b981' : 
    percentage >= 100 ? '#f59e0b' : '#10b981'
  )

  // Individual trolley colors based on capacity
  function getTrolleyColor(count: number): string {
    const percent = (count / maxItemsPerTrolley) * 100
    if (percent >= 100) return '#f59e0b' // Orange - at capacity
    if (percent >= 80) return '#10b981' // Green - high
    if (percent >= 50) return '#3b82f6' // Blue - medium
    return '#6b7280' // Gray - low
  }

  let colorA = $derived(getTrolleyColor(trolleyA))
  let colorB = $derived(getTrolleyColor(trolleyB))
  let colorC = $derived(getTrolleyColor(trolleyC))
</script>

<div class="inventory-chart">
  <div class="stat-display">
    <div class="count" style="color: {statusColor}">
      {totalCount}
    </div>
    <div class="label">total items across all trolleys</div>
  </div>

  <div class="progress-container">
    <div 
      class="progress-bar" 
      style="width: {percentage}%; background: {statusColor}"
    ></div>
    <div class="progress-text">{percentage.toFixed(1)}%</div>
  </div>

  <div class="status-indicator">
    <span class="status-dot" style="background: {statusColor}"></span>
    <span class="status-text">{status}</span>
  </div>

  <svg width="100%" height="160" viewBox="0 0 300 160" class="inventory-svg">
    <!-- Trolley A (trolley_id: 1) -->
    <g transform="translate(20, 20)">
      <rect x="0" y="0" width="60" height="100" fill="#e5e7eb" stroke="#64748b" stroke-width="2" rx="4" />
      <text x="30" y="-5" text-anchor="middle" font-size="10" fill="#64748b" font-weight="bold">Trolley 1</text>

      {#if trolleyA > 0}
        <rect 
          x="5" 
          y="{100 - heightA}" 
          width="50" 
          height="{heightA}" 
          fill={colorA} 
          opacity="0.8" 
        />
      {/if}
      
      <text x="30" y="110" text-anchor="middle" font-size="11" fill="#374151" font-weight="bold">
        {trolleyA}
      </text>
      <text x="30" y="120" text-anchor="middle" font-size="8" fill="#6b7280">
        {((trolleyA / maxItemsPerTrolley) * 100).toFixed(0)}% full
      </text>
    </g>

    <!-- Trolley B (trolley_id: 2) -->
    <g transform="translate(110, 20)">
      <rect x="0" y="0" width="60" height="100" fill="#e5e7eb" stroke="#64748b" stroke-width="2" rx="4" />
      <text x="30" y="-5" text-anchor="middle" font-size="10" fill="#64748b" font-weight="bold">Trolley 2</text>

      {#if trolleyB > 0}
        <rect 
          x="5" 
          y="{100 - heightB}" 
          width="50" 
          height="{heightB}" 
          fill={colorB} 
          opacity="0.8" 
        />
      {/if}
      
      <text x="30" y="110" text-anchor="middle" font-size="11" fill="#374151" font-weight="bold">
        {trolleyB}
      </text>
      <text x="30" y="120" text-anchor="middle" font-size="8" fill="#6b7280">
        {((trolleyB / maxItemsPerTrolley) * 100).toFixed(0)}% full
      </text>
    </g>

    <!-- Trolley C (trolley_id: 3) -->
    <g transform="translate(200, 20)">
      <rect x="0" y="0" width="60" height="100" fill="#e5e7eb" stroke="#64748b" stroke-width="2" rx="4" />
      <text x="30" y="-5" text-anchor="middle" font-size="10" fill="#64748b" font-weight="bold">Trolley 3</text>

      {#if trolleyC > 0}
        <rect 
          x="5" 
          y="{100 - heightC}" 
          width="50" 
          height="{heightC}" 
          fill={colorC} 
          opacity="0.8" 
        />
      {/if}
      
      <text x="30" y="110" text-anchor="middle" font-size="11" fill="#374151" font-weight="bold">
        {trolleyC}
      </text>
      <text x="30" y="120" text-anchor="middle" font-size="8" fill="#6b7280">
        {((trolleyC / maxItemsPerTrolley) * 100).toFixed(0)}% full
      </text>
    </g>
  </svg>
</div>

<style>
  .inventory-chart {
    text-align: center;
  }

  .stat-display {
    margin-bottom: 1rem;
  }

  .count {
    font-size: 3rem;
    font-weight: bold;
    line-height: 1;
    transition: color 0.3s;
  }

  .label {
    color: #6b7280;
    font-size: 0.9rem;
    margin-top: 0.25rem;
    font-weight: 500;
  }

  .progress-container {
    position: relative;
    width: 100%;
    height: 20px;
    background: #e5e7eb;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 1rem;
    border: 2px solid #cbd5e1;
  }

  .progress-bar {
    height: 100%;
    transition: width 0.5s ease, background 0.3s;
    border-radius: 8px;
  }

  .progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.75rem;
    font-weight: bold;
    color: #1f2937;
    text-shadow: 0 0 3px white;
  }

  .status-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    padding: 0.5rem;
    background: #f9fafb;
    border-radius: 6px;
  }

  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.1); }
  }

  .status-text {
    font-size: 0.9rem;
    font-weight: 600;
    color: #374151;
  }

  .inventory-svg {
    margin-top: 1rem;
    background: #f9fafb;
    border-radius: 8px;
    padding: 10px;
  }
</style>


================================================
FILE: src/lib/Counter.svelte
================================================
<script lang="ts">
  let count: number = $state(0)
  const increment = () => {
    count += 1
  }
</script>

<button onclick={increment}>
  count is {count}
</button>



================================================
FILE: .__mf__temp/analytics/localSharedImportMap.js
================================================
// Windows temporarily needs this file, https://github.com/module-federation/vite/issues/68

import { loadShare } from '@module-federation/runtime'
const importMap = {
  svelte: async () => {
    let pkg = await import('__mf__virtual/analytics__prebuild__svelte__prebuild__.js')
    return pkg
  },
}
const usedShared = {
  svelte: {
    name: 'svelte',
    version: '5.45.5',
    scope: ['default'],
    loaded: false,
    from: 'analytics',
    async get() {
      if (false) {
        throw new Error(`Shared module '${'svelte'}' must be provided by host`)
      }
      usedShared['svelte'].loaded = true
      const { svelte: pkgDynamicImport } = importMap
      const res = await pkgDynamicImport()
      const exportModule = { ...res }
      // All npm packages pre-built by vite will be converted to esm
      Object.defineProperty(exportModule, '__esModule', {
        value: true,
        enumerable: false,
      })
      return function () {
        return exportModule
      }
    },
    shareConfig: {
      singleton: true,
      requiredVersion: '^5.0.0',
    },
  },
}
const usedRemotes = []
export { usedShared, usedRemotes }


